# 我的ROS2学习之旅
作者：Minzi

## Week1： ROS2入门与基础概念
- 学习内容：ROS2 tutorials第一和第二章

## Week2：UR3机械臂仿真
- 学习内容：
  1. 学习并安装UR的ROS 2驱动（ur_robot_driver）
  2. 在可视化工具Rviz中看到一个UR3模型
  3.  熟悉Rviz和TF2
  4. 创建了一个package，可以控制rviz中的仿真ur3机械臂循环前往不同的轨迹点

## Week3：连接ur3真机，利用Moveit2规划轨迹
工作记录：

日期：20250926

### 第一步：环境准备
1. 创建一个新的容器，并创建新的工作空间，配置github SSH连接
2. 安装必要的ROS 2包
```
# 确保你的apt包列表是最新的
sudo apt update

# 安装UR的ROS 2驱动
sudo apt install ros-humble-ur-robot-driver

# 安装MoveIt 2核心库
sudo apt install ros-humble-moveit

# 安装UR机械臂的MoveIt配置包
sudo apt install ros-humble-ur-moveit-config
```
    说明：ur-robot-driver负责底层通信，moveit是运动规划框架，ur-moveit-config则包含了UR3的3D模型、关节限制、运动学求解器等配置文件，告诉MoveIt“我们正在使用UR3这台机器人”。
3. 创建我们自己的功能包

    现在，在src目录下创建我们自己的功能包，用来存放直线运动控制的Python脚本。
```bash
cd ~/workspaces3/src
ros2 pkg create --build-type ament_python ur3_moveit_control
```
### 第二步：连接并配置真实UR3机械臂

1. 配置真实的UR3机械臂
    
    为UR3机械臂安装URCaps External Control
    > 从[Universal_Robots_ROS2_Driver](https://github.com/UniversalRobots/Universal_Robots_ROS2_Driver.git) 的/ur_robot_driver/resources 文件夹下下载externalcontrol-1.0.5.urcap文件
    > 将此文件拷贝到U盘，插入UR示教器，在示教器上，进入`设置 ->URCaps`，点击`+`号从U盘文件中添加这个URCap，然后根据提示重启机械臂

2. 经检测不能连接艾目易定位仪，为艾目易定位仪更新驱动

    根据技术支持工程师的指导，按照驱动更新说明书操作：

    [驱动安装说明书](./assets/学习记录/2.AimPosition光学定位系统驱动安装说明书V2.2.pdf)

日期：20250927
  1. 重建新的容器

      在启动脚本处添加参数：`--network host`

      这样容器就和主机处于同一网络，可以直接访问机械臂
  2. 配置机械臂IP地址
   
      - 确保主机与机械臂的网线连接正确插入
      - 设置了机械臂的IP地址为169.254.1.8
      - 在主机的以太网适配器中，设置IPv4地址为169.254.1.9
      - 测试ping通

      ```
      root@docker-desktop:/ros2_workspaces# ping 169.254.1.8
      PING 169.254.1.8 (169.254.1.8) 56(84) bytes of data.
      64 bytes from 169.254.1.8: icmp_seq=1 ttl=64 time=1.78 ms
      64 bytes from 169.254.1.8: icmp_seq=2 ttl=64 time=1.43 ms
      64 bytes from 169.254.1.8: icmp_seq=3 ttl=64 time=2.77 ms
      64 bytes from 169.254.1.8: icmp_seq=4 ttl=64 time=3.30 ms
      64 bytes from 169.254.1.8: icmp_seq=5 ttl=64 time=2.02 ms
      64 bytes from 169.254.1.8: icmp_seq=6 ttl=64 time=2.58 ms
      64 bytes from 169.254.1.8: icmp_seq=7 ttl=64 time=1.38 ms
      ```

  3. 在容器中安装 UR ROS2 驱动（官方推荐）
      
      - 克隆源码仓库

      ```
        cd workspaces3/src
        git clone -b humble https://github.com/UniversalRobots/Universal_Robots_ROS2_Driver.git
        git clone -b humble https://github.com/UniversalRobots/Universal_Robots_ROS2_Description.git
      ```

      - 安装控制器（已包含在 driver 中，但确保依赖完整）

      ```
      sudo apt update
      sudo apt install ros-humble-ros2-control ros-humble-ros2-controllers \
                 ros-humble-joint-trajectory-controller \
                 ros-humble-velocity-controllers
      ```

      - 安装MoveIt2

      ```
      sudo apt install ros-humble-moveit
      ```

      - 编译文件
      ```
      cd workspace3
      colcon build --symlink-install
      source install/setup.bash
      ```

      - `colcon build --symlink-install`报错了
      ```
      root@docker-desktop:/ros2_workspaces/workspaces3# colcon build --symlink-install
      Starting >>> ur_dashboard_msgs
      Starting >>> ur_description
      Starting >>> ur3_cartesian_control
      --- stderr: ur_dashboard_msgs                                                                                                  
      CMake Error at CMakeLists.txt:4 (find_package):
        By not providing "Findament_cmake.cmake" in CMAKE_MODULE_PATH this project
        has asked CMake to find a package configuration file provided by
        "ament_cmake", but CMake did not find one.

        Could not find a package configuration file provided by "ament_cmake" with
        any of the following names:

          ament_cmakeConfig.cmake
          ament_cmake-config.cmake

        Add the installation prefix of "ament_cmake" to CMAKE_PREFIX_PATH or set
        "ament_cmake_DIR" to a directory containing one of the above files.  If
        "ament_cmake" provides a separate development package or SDK, be sure it
        has been installed.


      ---
      Failed   <<< ur_dashboard_msgs [1.37s, exited with code 1]
      Aborted  <<< ur_description [1.36s]
      Aborted  <<< ur3_cartesian_control [1.76s]                     

      Summary: 0 packages finished [2.20s]
        1 package failed: ur_dashboard_msgs
        2 packages aborted: ur3_cartesian_control ur_description
        2 packages had stderr output: ur_dashboard_msgs ur_description
        6 packages not processed
      ```
        - 原因：

          a. 没有`source /opt/ros/humble/setup.bash`
          
          b. 
        - 解决：
          - 在~/.bashrc中添加`source /opt/ros/humble/setup.bash`

          ```
          echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc 
          ```
          - 在新的终端重新尝试编译



